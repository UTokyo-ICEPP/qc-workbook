

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>データベース検索を行う &#8212; 量子コンピューティング・ワークブック</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'grover';</script>
    <link rel="shortcut icon" href="_static/favicon.ico"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="【課題】ビット反転ボードの操作を見つける" href="grover_number_light.html" />
    <link rel="prev" title="【課題】位相推定によるスペクトル分解" href="spectrum_estimation.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="welcome.html">
  
  
  
  
    
    
      
    
    
    <img src="_static/favicon.ico" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="_static/favicon.ico" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="welcome.html">
                    量子コンピューティング・ワークブックへようこそ！
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">量子コンピュータに触れる</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="chsh_inequality.html">CHSH不等式の破れを確認する</a></li>
<li class="toctree-l1"><a class="reference internal" href="nonlocal_correlations.html">【課題】量子相関を調べる</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">量子回路を作る</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="circuit_from_scratch.html">単純な量子回路をゼロから書く</a></li>
<li class="toctree-l1"><a class="reference internal" href="quantum_computation.html">【課題】アダマールテスト</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">量子コンピュータでの並列計算</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="extreme_simd.html">計算をする量子回路の実装</a></li>
<li class="toctree-l1"><a class="reference internal" href="dynamics_simulation.html">物理系を表現する</a></li>
<li class="toctree-l1"><a class="reference internal" href="more_dynamics.html">【課題】量子ダイナミクスシミュレーション・続</a></li>
<li class="toctree-l1"><a class="reference internal" href="addition_on_ibmq.html">【参考】足し算を実機で行う</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">ショアのアルゴリズム</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="shor.html">素因数分解アルゴリズムを学習する</a></li>
<li class="toctree-l1"><a class="reference internal" href="spectrum_estimation.html">【課題】位相推定によるスペクトル分解</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">グローバーのアルゴリズム</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 current active"><a class="current reference internal" href="#">データベース検索を行う</a></li>
<li class="toctree-l1"><a class="reference internal" href="grover_number_light.html">【課題】ビット反転ボードの操作を見つける</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">変分法と変分量子固有値ソルバー</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="vqe.html">変分法と変分量子固有値ソルバー法を学習する</a></li>
<li class="toctree-l1"><a class="reference internal" href="vqe_tracking.html">【課題】高エネルギー実験で生成された荷電粒子の飛跡を見つける</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">量子・古典ハイブリッド機械学習</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="vqc_machine_learning.html">量子機械学習を使った新しい素粒子現象の探索</a></li>
<li class="toctree-l1"><a class="reference internal" href="qkc_machine_learning.html">【課題】量子カーネルを使った新現象の分類</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">演習</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="toffoli_shor_code.html">ToffoliゲートとShorコード</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">補足</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="prerequisites.html">実習の準備</a></li>
<li class="toctree-l1"><a class="reference internal" href="python_intro.html">予備知識：Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="numerics.html">予備知識：数値表現</a></li>
<li class="toctree-l1"><a class="reference internal" href="references.html">参考文献</a></li>
<li class="toctree-l1"><a class="reference internal" href="bibliography.html">文献一覧</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://mybinder.org/v2/gh/UTokyo-ICEPP/qc-workbook/master?urlpath=lab/tree/grover.md" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onBinder"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="_static/images/logo_binder.svg">
  </span>
<span class="btn__text-container">Binder</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="initThebeSBT()"
  class="btn btn-sm btn-launch-thebe dropdown-item"
  title="Launch Thebe"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-play"></i>
  </span>
<span class="btn__text-container">Live Code</span>
</button>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/UTokyo-ICEPP/qc-workbook" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/UTokyo-ICEPP/qc-workbook/issues/new?title=Issue%20on%20page%20%2Fgrover.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/grover.ipynb" target="_blank"
   class="btn btn-sm btn-download-notebook-button dropdown-item"
   title="Download notebook file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-code"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li><a href="_sources/grover.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>データベース検索を行う</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">はじめに</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#database">非構造化データの検索</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#grover">グローバーのアルゴリズム</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#grover-phaseoracle">位相オラクルの導入</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#grover-circuit">量子回路の構成</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#grover-superposition">重ね合わせ状態の生成</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#grover-geometry">幾何学的な表現</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#grover-oracle">オラクルの適用</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#diffuser">Diffuserの適用</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#grover-amp">振幅増幅を可視化する</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#grover-multidata">複数データの検索</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#n-2-6">アルゴリズムの実装（<span class="math notranslate nohighlight">\(N=2^6\)</span>の場合）</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#qiskit">Qiskitでの実装</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#imp-simulator">シミュレータでの実験</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#imp-qc">量子コンピュータでの実験</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#imp-simulator-amp">振幅増幅を確認する</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#imp-simulator-multi">複数解の探索の場合</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="id1">
<h1>データベース検索を行う<a class="headerlink" href="#id1" title="Permalink to this heading">#</a></h1>
<p>ここでは、<strong>グローバーのアルゴリズム</strong><span id="id2">[<a class="reference internal" href="bibliography.html#id20" title="Lov K Grover. A fast quantum mechanical algorithm for database search. 1996. arXiv:quant-ph/9605043.">Gro96</a>, <a class="reference internal" href="bibliography.html#id8" title="Michael A Nielsen and Isaac L Chuang. Quantum Computation and Quantum Information, chapter 6, pages 249-276. Cambridge University Press, 2000.">NC00d</a>]</span>の紹介と、そのアルゴリズムを使用して構造化されていないデータベースを検索する問題を考えます。アルゴリズムを説明した後に、Qiskitを使用してグローバーのアルゴリズムを実装します。</p>
<div class="contents local topic" id="id3">
<p class="topic-title">目次</p>
<ul class="simple">
<li><p><a class="reference internal" href="#id4" id="id18">はじめに</a></p></li>
<li><p><a class="reference internal" href="#database" id="id19">非構造化データの検索</a></p></li>
<li><p><a class="reference internal" href="#grover" id="id20">グローバーのアルゴリズム</a></p>
<ul>
<li><p><a class="reference internal" href="#grover-phaseoracle" id="id21">位相オラクルの導入</a></p></li>
<li><p><a class="reference internal" href="#grover-circuit" id="id22">量子回路の構成</a></p></li>
<li><p><a class="reference internal" href="#grover-superposition" id="id23">重ね合わせ状態の生成</a></p></li>
<li><p><a class="reference internal" href="#grover-geometry" id="id24">幾何学的な表現</a></p></li>
<li><p><a class="reference internal" href="#grover-oracle" id="id25">オラクルの適用</a></p></li>
<li><p><a class="reference internal" href="#diffuser" id="id26">Diffuserの適用</a></p></li>
<li><p><a class="reference internal" href="#grover-amp" id="id27">振幅増幅を可視化する</a></p></li>
<li><p><a class="reference internal" href="#grover-multidata" id="id28">複数データの検索</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#n-2-6" id="id29">アルゴリズムの実装（<span class="math notranslate nohighlight">\(N=2^6\)</span>の場合）</a></p>
<ul>
<li><p><a class="reference internal" href="#qiskit" id="id30">Qiskitでの実装</a></p></li>
<li><p><a class="reference internal" href="#imp-simulator" id="id31">シミュレータでの実験</a></p></li>
<li><p><a class="reference internal" href="#imp-qc" id="id32">量子コンピュータでの実験</a></p></li>
<li><p><a class="reference internal" href="#imp-simulator-amp" id="id33">振幅増幅を確認する</a></p></li>
<li><p><a class="reference internal" href="#imp-simulator-multi" id="id34">複数解の探索の場合</a></p></li>
</ul>
</li>
</ul>
</div>
<p><span class="math notranslate nohighlight">\(\newcommand{\ket}[1]{| #1 \rangle}\)</span>
<span class="math notranslate nohighlight">\(\newcommand{\bra}[1]{\langle #1 |}\)</span>
<span class="math notranslate nohighlight">\(\newcommand{\braket}[2]{\langle #1 | #2 \rangle}\)</span></p>
<section id="id4">
<h2><a class="toc-backref" href="#id18">はじめに</a><a class="headerlink" href="#id4" title="Permalink to this heading">#</a></h2>
<p>量子コンピュータが古典コンピュータの計算能力を優位に上回る性能を発揮するためには、量子計算の特徴をうまく活用するアルゴリズムを考える必要があります。そのような量子アルゴリズムの一つとして知られているのが、グローバーのアルゴリズムです。このアルゴリズムは<strong>構造化されていないデータベースの検索</strong>に適しており、古典計算より少ない計算量で答えを得られることが証明されています。このアルゴリズムは<strong>振幅増幅</strong>と呼ばれる手法をベースにしており、量子アルゴリズムのサブルーチンとしても幅広く活用されています。</p>
</section>
<section id="database">
<span id="id5"></span><h2><a class="toc-backref" href="#id19">非構造化データの検索</a><a class="headerlink" href="#database" title="Permalink to this heading">#</a></h2>
<p><span class="math notranslate nohighlight">\(N\)</span>個の要素からなるリストがあり、その中の一つの要素<span class="math notranslate nohighlight">\(w\)</span>を見つけたいとします。求める要素<span class="math notranslate nohighlight">\(w\)</span>を見つけるためには、古典計算では最悪の場合<span class="math notranslate nohighlight">\(N\)</span>回、平均では<span class="math notranslate nohighlight">\(N/2\)</span>回リストを調べる必要があります。グローバーのアルゴリズムでは、おおよそ<span class="math notranslate nohighlight">\(\sqrt{N}\)</span>回の検索で<span class="math notranslate nohighlight">\(w\)</span>を見つけることができることが知られています。つまり、<strong>古典計算に対して二次の高速化が可能</strong>というわけです。</p>
</section>
<section id="grover">
<span id="id6"></span><h2><a class="toc-backref" href="#id20">グローバーのアルゴリズム</a><a class="headerlink" href="#grover" title="Permalink to this heading">#</a></h2>
<p>ここでは<span class="math notranslate nohighlight">\(n\)</span>個の量子ビットを考え、その量子ビットが表現できる可能性のある全ての計算基底でリストが構成されているものとします。つまり<span class="math notranslate nohighlight">\(N=2^n\)</span>として、リストは<span class="math notranslate nohighlight">\(\ket{00\cdots00}\)</span>, <span class="math notranslate nohighlight">\(\ket{00\cdots01}\)</span>, <span class="math notranslate nohighlight">\(\ket{00\cdots10}\)</span>, <span class="math notranslate nohighlight">\(\cdots\)</span>, <span class="math notranslate nohighlight">\(\ket{11\cdots11}\)</span>までの<span class="math notranslate nohighlight">\(N\)</span>個の要素（10進数表記だと<span class="math notranslate nohighlight">\(\ket{0}\)</span>, <span class="math notranslate nohighlight">\(\ket{1}\)</span>, <span class="math notranslate nohighlight">\(\cdots\)</span>, <span class="math notranslate nohighlight">\(\ket{N-1}\)</span>）を含んでいます。</p>
<section id="grover-phaseoracle">
<span id="id7"></span><h3><a class="toc-backref" href="#id21">位相オラクルの導入</a><a class="headerlink" href="#grover-phaseoracle" title="Permalink to this heading">#</a></h3>
<p>グローバーのアルゴリズムで重要になるのは、特定の状態の位相を変える位相オラクルです。まず、<span class="math notranslate nohighlight">\(U\ket{x}=(-1)^{f(x)}\ket{x}\)</span>で与えられる位相オラクルを考えます。つまりある状態<span class="math notranslate nohighlight">\(\ket{x}\)</span>に作用すると、その状態の位相をある関数<span class="math notranslate nohighlight">\(f(x)\)</span>に応じて<span class="math notranslate nohighlight">\(-1^{f(x)}\)</span>だけシフトさせるような演算です。ここで<span class="math notranslate nohighlight">\(f(x)\)</span>として</p>
<div class="math notranslate nohighlight">
\[\begin{split}
f(x) = \bigg\{
\begin{aligned}
&amp;1 \quad \text{if} \; x = w \\
&amp;0 \quad \text{else} \\
\end{aligned}
\end{split}\]</div>
<p>のような関数を考えると、求める解<span class="math notranslate nohighlight">\(w\)</span>の位相を反転するオラクル<span class="math notranslate nohighlight">\(U_w\)</span></p>
<div class="math notranslate nohighlight">
\[\begin{split}
U_w:\begin{aligned}
&amp;\ket{w} \to -\ket{w}\\
&amp;\ket{x} \to \ket{x} \quad \forall \; x \neq w
\end{aligned}
\end{split}\]</div>
<p>が得られます。この時、<span class="math notranslate nohighlight">\(U_w\)</span>は<span class="math notranslate nohighlight">\(U_w=I-2\ket{w}\bra{ w}\)</span>と表現できることが分かります。また、関数<span class="math notranslate nohighlight">\(f_0(x)\)</span>として</p>
<div class="math notranslate nohighlight">
\[\begin{split}
f_0(x) = \bigg\{
\begin{aligned}
&amp;0 \quad \text{if} \; x = 0 \\
&amp;1 \quad \text{else} \\
\end{aligned}
\end{split}\]</div>
<p>を考えると、0以外の位相を反転するユニタリー<span class="math notranslate nohighlight">\(U_0\)</span></p>
<div class="math notranslate nohighlight">
\[\begin{split}
U_0:\begin{aligned}
&amp;\ket{0}^{\otimes n} \to \ket{0}^{\otimes n}\\
&amp;\ket{x} \to -\ket{x} \quad \forall \; x \neq 0
\end{aligned}
\end{split}\]</div>
<p>を得ることができます。この時、<span class="math notranslate nohighlight">\(U_0\)</span>は<span class="math notranslate nohighlight">\(U_0=2\ket{0}\bra{ 0}^{\otimes n}-I\)</span>になります。</p>
</section>
<section id="grover-circuit">
<span id="id8"></span><h3><a class="toc-backref" href="#id22">量子回路の構成</a><a class="headerlink" href="#grover-circuit" title="Permalink to this heading">#</a></h3>
<p>グローバーアルゴリズムを実装する量子回路の構造は、下図のようになっています。<span class="math notranslate nohighlight">\(n\)</span>量子ビットの回路を<span class="math notranslate nohighlight">\(\ket{0}\)</span>の初期状態から出発し、Hadamard演算を適用して重ね合わせ状態を作ります。その後、<span class="math notranslate nohighlight">\(G\)</span>と書かれている演算を繰り返し適用します。</p>
<a class="reference internal image-reference" href="_images/grover.png"><img alt="grover" class="align-center" src="_images/grover.png" style="width: 600px;" /></a>
<p><span class="math notranslate nohighlight">\(G\)</span>は「<strong>グローバーの反復</strong>」とも呼ばれるユニタリー演算で、以下のような4つのステップから構成されています。</p>
<a class="reference internal image-reference" href="_images/grover_iter.png"><img alt="grover_iter" class="align-center" src="_images/grover_iter.png" style="width: 550px;" /></a>
<p><span class="math notranslate nohighlight">\(U_w\)</span>と<span class="math notranslate nohighlight">\(U_0\)</span>は、それぞれ上で説明した解<span class="math notranslate nohighlight">\(w\)</span>の位相を反転するオラクルと0以外の位相を反転するオラクルです。</p>
<p>回路の最初にあるHadamard演算と合わせて、グローバーの反復を1回実行するまでのステップ</p>
<a class="reference internal image-reference" href="_images/grover_iter1.png"><img alt="grover_iter1" class="align-center" src="_images/grover_iter1.png" style="width: 600px;" /></a>
<p>を細かく見ていきます。</p>
</section>
<section id="grover-superposition">
<span id="id9"></span><h3><a class="toc-backref" href="#id23">重ね合わせ状態の生成</a><a class="headerlink" href="#grover-superposition" title="Permalink to this heading">#</a></h3>
<p>まず、<span class="math notranslate nohighlight">\(n\)</span>量子ビット回路の初期状態<span class="math notranslate nohighlight">\(\ket{0}^{\otimes n}\)</span>にHadamard演算を適用し、一様に重ね合わされた状態を生成します。</p>
<div class="math notranslate nohighlight">
\[
\ket{s} = H^{\otimes n}\ket{0}^{\otimes n} = \frac{1}{\sqrt{N}}\sum_{x=0}^{N-1}\ket{x}
\]</div>
<p>この状態を<span class="math notranslate nohighlight">\(\ket{s}\)</span>とします。</p>
</section>
<section id="grover-geometry">
<span id="id10"></span><h3><a class="toc-backref" href="#id24">幾何学的な表現</a><a class="headerlink" href="#grover-geometry" title="Permalink to this heading">#</a></h3>
<p>この<span class="math notranslate nohighlight">\(\ket{s}\)</span>の状態を幾何学的に表現してみましょう。まず、重ね合わせ状態<span class="math notranslate nohighlight">\(\ket{s}\)</span>と求める状態<span class="math notranslate nohighlight">\(\ket{w}\)</span>が張る2次元平面を考えます。<span class="math notranslate nohighlight">\(\ket{w}\)</span>に直交する状態<span class="math notranslate nohighlight">\(\ket{w^{\perp}}\)</span>は<span class="math notranslate nohighlight">\(\ket{w^{\perp}}:=\frac{1}{\sqrt{N-1}}\sum_{x \neq w}\ket{x}\)</span>と表現できるため、この平面上では<span class="math notranslate nohighlight">\(\ket{w}\)</span>に直交する軸に相当します。簡易的に、この平面では<span class="math notranslate nohighlight">\(\ket{w^{\perp}}=\begin{bmatrix}1\\0\end{bmatrix}\)</span>と<span class="math notranslate nohighlight">\(\ket{w}=\begin{bmatrix}0\\1\end{bmatrix}\)</span>と書くことにします。</p>
<p>まとめると、この2次元平面では<span class="math notranslate nohighlight">\(\ket{s}\)</span>は(<span class="math notranslate nohighlight">\(\ket{w^{\perp}}\)</span>, <span class="math notranslate nohighlight">\(\ket{w}\)</span>)という二つのベクトルの線形和として書くことができます。</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{aligned}
\ket{s}&amp;=\sqrt{\frac{N-1}{N}}\ket{w^{\perp}}+\frac1{\sqrt{N}}\ket{w}\\
&amp;=: \cos\frac\theta2\ket{w^{\perp}}+\sin\frac\theta2\ket{w}\\
&amp;= \begin{bmatrix}\cos\frac\theta2\\\sin\frac\theta2\end{bmatrix}
\end{aligned}
\end{split}\]</div>
<p>答えが一つであるため、<span class="math notranslate nohighlight">\(\ket{w}\)</span>の振幅は<span class="math notranslate nohighlight">\(\frac1{\sqrt{N}}\)</span>、<span class="math notranslate nohighlight">\(\ket{w^{\perp}}\)</span>の振幅は<span class="math notranslate nohighlight">\(\sqrt{\frac{N-1}{N}}\)</span>になります。<span class="math notranslate nohighlight">\(\sin\frac\theta2=\frac1{\sqrt{N}}\)</span>なる<span class="math notranslate nohighlight">\(\theta\)</span>を定義すると、</p>
<div class="math notranslate nohighlight">
\[
\theta=2\arcsin\frac{1}{\sqrt{N}}
\]</div>
<p>になります。(<span class="math notranslate nohighlight">\(\ket{w^{\perp}}\)</span>, <span class="math notranslate nohighlight">\(\ket{w}\)</span>)平面での<span class="math notranslate nohighlight">\(\ket{s}\)</span>を図示すると、以下のようになります。</p>
<a class="reference internal image-reference" href="_images/grover_rot1.png"><img alt="grover_rot1" class="align-center" src="_images/grover_rot1.png" style="width: 300px;" /></a>
</section>
<section id="grover-oracle">
<span id="id11"></span><h3><a class="toc-backref" href="#id25">オラクルの適用</a><a class="headerlink" href="#grover-oracle" title="Permalink to this heading">#</a></h3>
<p>次に、<span class="math notranslate nohighlight">\(\ket{s}\)</span>にオラクル<span class="math notranslate nohighlight">\(U_w\)</span>を適用します。このオラクルは、この平面上では<span class="math notranslate nohighlight">\(U_w=I-2\ket{w}\bra{ w}=\begin{bmatrix}1&amp;0\\0&amp;-1\end{bmatrix}\)</span>と表現することが可能です。つまり、<span class="math notranslate nohighlight">\(U_w\)</span>は<span class="math notranslate nohighlight">\(\ket{w^{\perp}}\)</span>軸に関して<span class="math notranslate nohighlight">\(\ket{s}\)</span>を折り返す操作（下図）に対応しており、この操作で<span class="math notranslate nohighlight">\(\ket{w}\)</span>の位相が反転します。</p>
<a class="reference internal image-reference" href="_images/grover_rot2.png"><img alt="grover_rot2" class="align-center" src="_images/grover_rot2.png" style="width: 300px;" /></a>
</section>
<section id="diffuser">
<span id="grover-diffuser"></span><h3><a class="toc-backref" href="#id26">Diffuserの適用</a><a class="headerlink" href="#diffuser" title="Permalink to this heading">#</a></h3>
<p>次は<span class="math notranslate nohighlight">\(H^{\otimes n}U_0H^{\otimes n}\)</span>の適用で、この演算はDiffuserと呼ばれます。<span class="math notranslate nohighlight">\(U_0=2\ket{0}\bra{0}^{\otimes n}-I\)</span>なので、<span class="math notranslate nohighlight">\(U_s \equiv H^{\otimes n}U_0H^{\otimes n}\)</span>と定義すると</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{aligned}
U_s &amp;\equiv H^{\otimes n}U_0H^{\otimes n}\\
&amp;=2H^{\otimes n}\ket{0}^{\otimes n}\bra{0}^{\otimes n}H^{\otimes n}-H^{\otimes n}H^{\otimes n}\\
&amp;=2\ket{s}\bra{ s}-I\\
&amp;=\begin{bmatrix}\cos\theta&amp;\sin\theta\\\sin\theta&amp;-\cos\theta\end{bmatrix}
\end{aligned}
\end{split}\]</div>
<p>になります。つまり、Diffuser<span class="math notranslate nohighlight">\(U_s\)</span>は<span class="math notranslate nohighlight">\(U_w\ket{s}\)</span>を<span class="math notranslate nohighlight">\(\ket{s}\)</span>に関して折り返す操作に対応します（下図）。</p>
<a class="reference internal image-reference" href="_images/grover_rot3.png"><img alt="grover_rot3" class="align-center" src="_images/grover_rot3.png" style="width: 300px;" /></a>
<p>まとめると、グローバーの反復<span class="math notranslate nohighlight">\(G=U_sU_w\)</span>は</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{aligned}
G&amp;=U_sU_w\\
&amp;= \begin{bmatrix}\cos\theta&amp;-\sin\theta\\\sin\theta&amp;\cos\theta\end{bmatrix}
\end{aligned}
\end{split}\]</div>
<p>であるため、<span class="math notranslate nohighlight">\(\ket{s}\)</span>を<span class="math notranslate nohighlight">\(\ket{w}\)</span>に向けて角度<span class="math notranslate nohighlight">\(\theta\)</span>だけ回転する操作を表していることが分かります（下図）。</p>
<a class="reference internal image-reference" href="_images/grover_rot4.png"><img alt="grover_rot4" class="align-center" src="_images/grover_rot4.png" style="width: 300px;" /></a>
<p><span class="math notranslate nohighlight">\(G\)</span>を1回適用すれば<span class="math notranslate nohighlight">\(\theta\)</span>だけ回転するということは、<span class="math notranslate nohighlight">\(G\)</span>を<span class="math notranslate nohighlight">\(r\)</span>回繰り返せば<span class="math notranslate nohighlight">\(r\theta\)</span>回転することになります。その時の<span class="math notranslate nohighlight">\(\ket{s}\)</span>の状態は</p>
<div class="math notranslate nohighlight">
\[\begin{split}
G^r\ket{s}=\begin{bmatrix}\cos\frac{2r+1}{2}\theta\\\sin\frac{2r+1}{2}\theta\end{bmatrix}
\end{split}\]</div>
<p>で与えられます。つまり、求める答え<span class="math notranslate nohighlight">\(\ket{w}\)</span>に到達するためには、<span class="math notranslate nohighlight">\(\frac{2r+1}2\theta\approx\frac{\pi}2\)</span>となる<span class="math notranslate nohighlight">\(r\)</span>の回数だけ回転すれば良いことになります。
1回の回転角<span class="math notranslate nohighlight">\(\theta\)</span>が十分小さいとして、<span class="math notranslate nohighlight">\(\sin\frac\theta2=\frac{1}{\sqrt{N}}\approx\frac\theta2\)</span>とすると、<span class="math notranslate nohighlight">\(r\approx\frac\pi4\sqrt{N}\)</span>が得られます。つまり<span class="math notranslate nohighlight">\({\cal O}(\sqrt{N})\)</span>の操作で答え<span class="math notranslate nohighlight">\(\ket{w}\)</span>に到達することが示せたわけであり、古典計算に対する2次の高速化が得られることが分かりました。</p>
<p>Diffuserの役割をもう少し見てみましょう。ある状態<span class="math notranslate nohighlight">\(\ket{\psi}\)</span>が、<span class="math notranslate nohighlight">\(\ket{\psi}:=\sum_k a_k\ket{k}\)</span>という振幅<span class="math notranslate nohighlight">\(a_k\)</span>を持つ<span class="math notranslate nohighlight">\(\ket{k}\)</span>の重ね合わせ状態として書かれるとしましょう。この状態にDiffuserを適用すると</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{aligned}
\left( 2\ket{s}\bra{ s} - I \right)\ket{\psi}&amp;=\frac2N\sum_i\ket{i}\cdot\sum_{j,k}a_k\braket{j}{k}-\sum_k a_k\ket{k}\\
&amp;= 2\frac{\sum_i a_i}{N}\sum_k\ket{k}-\sum_k a_k\ket{k}\\
&amp;= \sum_k \left( 2\langle a \rangle-a_k \right)\ket{k}
\end{aligned}
\end{split}\]</div>
<p>となります。<span class="math notranslate nohighlight">\(\langle a \rangle\equiv\frac{\sum_i a_i}{N}\)</span>は振幅の平均です。この式が意味するところは、ある状態<span class="math notranslate nohighlight">\(\ket{k}\)</span>の振幅<span class="math notranslate nohighlight">\(a_k\)</span>が、平均に対する摂動の形<span class="math notranslate nohighlight">\(a_k=\langle a \rangle-\Delta\)</span>で表現できると考えると理解しやすくなります。つまり、Diffuserを適用した後の振幅が<span class="math notranslate nohighlight">\(2\langle a \rangle-a_k=\langle a \rangle+\Delta\)</span>になることから、Diffuserは平均<span class="math notranslate nohighlight">\(\langle a \rangle\)</span>に関して振幅を反転する操作を表していると考えることができるわけです。</p>
</section>
<section id="grover-amp">
<span id="id12"></span><h3><a class="toc-backref" href="#id27">振幅増幅を可視化する</a><a class="headerlink" href="#grover-amp" title="Permalink to this heading">#</a></h3>
<p>グローバーアルゴリズムで振幅がどのように増幅されるのか、実際目で見てみることにします。</p>
<p>まず最初のHadamard変換で、全ての計算基底が等しい振幅を持つ重ね合わせ状態を生成します（下図の1）。横軸は<span class="math notranslate nohighlight">\(N\)</span>個の計算基底、縦軸は各基底の振幅の大きさを表しており、全ての基底が<span class="math notranslate nohighlight">\(\frac{1}{\sqrt{N}}\)</span>の大きさの振幅を持っています（振幅の平均を赤破線で表示）。</p>
<p>次にオラクル<span class="math notranslate nohighlight">\(U_w\)</span>を適用すると、<span class="math notranslate nohighlight">\(\ket{w}\)</span>の位相が反転し、振幅が<span class="math notranslate nohighlight">\(-\frac{1}{\sqrt{N}}\)</span>になります（下図の2）。この状態での振幅の平均は<span class="math notranslate nohighlight">\(\frac{1}{\sqrt{N}}(1-\frac2N)\)</span>になり、(1)の状態より低くなります。</p>
<p>最後にDiffuserを適用すると、平均に関して振幅を反転します（下図の3）。その結果、<span class="math notranslate nohighlight">\(\ket{w}\)</span>の振幅が増幅され、<span class="math notranslate nohighlight">\(\ket{w}\)</span>以外の基底の振幅は減少します。1回のグローバーの反復操作で、<span class="math notranslate nohighlight">\(\ket{w}\)</span>の振幅が約3倍程度増幅することも図から見てとれます。この操作を繰り返し実行すれば<span class="math notranslate nohighlight">\(\ket{w}\)</span>の振幅がさらに増幅されるため、正しい答えを得る確率が増加していくだろうということも予想できますね。</p>
<a class="reference internal image-reference" href="_images/grover_amp.png"><img alt="grover_amp" class="align-center" src="_images/grover_amp.png" style="width: 800px;" /></a>
</section>
<section id="grover-multidata">
<span id="id13"></span><h3><a class="toc-backref" href="#id28">複数データの検索</a><a class="headerlink" href="#grover-multidata" title="Permalink to this heading">#</a></h3>
<p>今までは検索するデータが一つだけの場合を考えてきましたが、このセクションの最後に複数のデータを検索する場合を考察してみましょう。例えば、<span class="math notranslate nohighlight">\(N=2^n\)</span>個のデータから<span class="math notranslate nohighlight">\(M\)</span>個のデータ<span class="math notranslate nohighlight">\(\{w_i\}\;(i=0,1,\cdots,M-1)\)</span>を探すケースです。これまでと同様に、求める状態<span class="math notranslate nohighlight">\(\ket{w}\)</span>とそれに直行する状態<span class="math notranslate nohighlight">\(\ket{w^{\perp}}\)</span></p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{aligned}
&amp;\ket{w}:=\frac{1}{\sqrt{M}}\sum_{i=0}^{M-1}\ket{w_i}\\
&amp;\ket{w^{\perp}}:=\frac{1}{\sqrt{N-M}}\sum_{x\notin\{w_0,\cdots,w_{M-1}\}}\ket{x}
\end{aligned}
\end{split}\]</div>
<p>が張る2次元平面の上で、同様の議論を進めることができます。<span class="math notranslate nohighlight">\(\ket{s}\)</span>はこの平面上で</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{aligned}
\ket{s}&amp;=\sqrt{\frac{N-M}{N}}\ket{w^{\perp}}+\sqrt{\frac{M}{N}}\ket{w}\\
&amp;=: \cos\frac\theta2\ket{w^{\perp}}+\sin\frac\theta2\ket{w}\\
\end{aligned}
\end{split}\]</div>
<p>と表現でき、<span class="math notranslate nohighlight">\(\ket{w}\)</span>の振幅<span class="math notranslate nohighlight">\(\sqrt{\frac{M}{N}}\)</span>を<span class="math notranslate nohighlight">\(\sin\frac\theta2\)</span>と定義すると、角度<span class="math notranslate nohighlight">\(\theta\)</span>は<span class="math notranslate nohighlight">\(\theta=2\arcsin\sqrt{\frac{M}{N}}\)</span>になります。答えが一つのケースと比べて、角度は<span class="math notranslate nohighlight">\(\sqrt{M}\)</span>倍大きく、1回のグローバーの反復操作でより大きく回転することになります。その結果、より少ない<span class="math notranslate nohighlight">\(r\approx\frac\pi4\sqrt{\frac{N}{M}}\)</span>回の回転操作で答えに到達することが可能になることが分かります。</p>
</section>
</section>
<section id="n-2-6">
<span id="imp"></span><h2><a class="toc-backref" href="#id29">アルゴリズムの実装（<span class="math notranslate nohighlight">\(N=2^6\)</span>の場合）</a><a class="headerlink" href="#n-2-6" title="Permalink to this heading">#</a></h2>
<p>ではここから、実際にグローバーアルゴリズムを実装してデータベースの検索問題に取り掛かってみましょう。</p>
<p>ここで考える問題は、<span class="math notranslate nohighlight">\(N=2^6\)</span>個の要素を持つリスト（<span class="math notranslate nohighlight">\(=[0,1,2,\cdots,63]\)</span>）から、一つの答え”45”を見つけるグローバーアルゴリズムの実装です（もちろんこの数はなんでも良いので、後で自由に変更して遊んでみてください）。つまり6量子ビットの量子回路を使って、<span class="math notranslate nohighlight">\(\ket{45}=\ket{101101}\)</span>を探す問題です。</p>
<section id="qiskit">
<span id="imp-qiskit"></span><h3><a class="toc-backref" href="#id30">Qiskitでの実装</a><a class="headerlink" href="#qiskit" title="Permalink to this heading">#</a></h3>
<p>まず必要な環境をセットアップします。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Tested with python 3.8.12, qiskit 0.34.2, numpy 1.22.2</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># Qiskit関連のパッケージをインポート</span>
<span class="kn">from</span> <span class="nn">qiskit</span> <span class="kn">import</span> <span class="n">QuantumCircuit</span><span class="p">,</span> <span class="n">ClassicalRegister</span><span class="p">,</span> <span class="n">QuantumRegister</span><span class="p">,</span> <span class="n">transpile</span>
<span class="kn">from</span> <span class="nn">qiskit.quantum_info</span> <span class="kn">import</span> <span class="n">Statevector</span>
<span class="kn">from</span> <span class="nn">qiskit.visualization</span> <span class="kn">import</span> <span class="n">plot_histogram</span>
<span class="kn">from</span> <span class="nn">qiskit.tools.monitor</span> <span class="kn">import</span> <span class="n">job_monitor</span>
<span class="kn">from</span> <span class="nn">qiskit_aer</span> <span class="kn">import</span> <span class="n">AerSimulator</span>
<span class="kn">from</span> <span class="nn">qiskit_ibm_provider</span> <span class="kn">import</span> <span class="n">IBMProvider</span><span class="p">,</span> <span class="n">least_busy</span>
<span class="kn">from</span> <span class="nn">qiskit_ibm_provider.accounts</span> <span class="kn">import</span> <span class="n">AccountNotFoundError</span>

<span class="c1"># ワークブック独自のモジュール</span>
<span class="kn">from</span> <span class="nn">qc_workbook.utils</span> <span class="kn">import</span> <span class="n">operational_backend</span>
</pre></div>
</div>
</div>
</div>
<p>6量子ビットの回路<code class="docutils literal notranslate"><span class="pre">grover_circuit</span></code>を準備します。</p>
<p>グローバー反復を一回実行する量子回路は以下のような構成になりますが、赤枠で囲んだ部分（オラクルとDiffuserの中の<span class="math notranslate nohighlight">\(2\ket{0}\bra{0}-I\)</span>の部分）を実装する量子回路を書いてください。</p>
<a class="reference internal image-reference" href="_images/grover_6bits_45.png"><img alt="grover_6bits_45" class="align-center" src="_images/grover_6bits_45.png" style="width: 600px;" /></a>
<p>一様な重ね合わせ状態<span class="math notranslate nohighlight">\(\ket{s}\)</span>を生成した後に、オラクルを実装します。</p>
<div class="cell tag_remove-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Nsol</span> <span class="o">=</span> <span class="mi">45</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">6</span>

<span class="n">grover_circuit</span> <span class="o">=</span> <span class="n">QuantumCircuit</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>

<span class="n">grover_circuit</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>

<span class="c1"># オラクルを作成して、回路に実装</span>
<span class="n">oracle</span> <span class="o">=</span> <span class="n">QuantumCircuit</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>

<span class="c1">##################</span>
<span class="c1">### EDIT BELOW ###</span>
<span class="c1">##################</span>

<span class="c1">#oracle.?</span>

<span class="c1">##################</span>
<span class="c1">### EDIT ABOVE ###</span>
<span class="c1">##################</span>

<span class="n">oracle_gate</span> <span class="o">=</span> <span class="n">oracle</span><span class="o">.</span><span class="n">to_gate</span><span class="p">()</span>
<span class="n">oracle_gate</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;U_w&quot;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">oracle</span><span class="p">)</span>

<span class="n">grover_circuit</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">oracle_gate</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)))</span>
<span class="n">grover_circuit</span><span class="o">.</span><span class="n">barrier</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p><strong>解答</strong></p>
<div class="toggle docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">##################</span>
<span class="c1">### EDIT BELOW ###</span>
<span class="c1">##################</span>

<span class="n">oracle</span><span class="o">.</span><span class="n">x</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">oracle</span><span class="o">.</span><span class="n">x</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">oracle</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">oracle</span><span class="o">.</span><span class="n">mcx</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)),</span> <span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">oracle</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">oracle</span><span class="o">.</span><span class="n">x</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">oracle</span><span class="o">.</span><span class="n">x</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>

<span class="c1">##################</span>
<span class="c1">### EDIT ABOVE ###</span>
<span class="c1">##################</span>
</pre></div>
</div>
</div>
<p>次に、Diffuser用の回路を実装します。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">diffuser</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="n">qc</span> <span class="o">=</span> <span class="n">QuantumCircuit</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>

    <span class="n">qc</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>

    <span class="c1">##################</span>
    <span class="c1">### EDIT BELOW ###</span>
    <span class="c1">##################</span>

    <span class="c1">#qc.?</span>

    <span class="c1">##################</span>
    <span class="c1">### EDIT ABOVE ###</span>
    <span class="c1">##################</span>

    <span class="n">qc</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>

    <span class="c1">#print(qc)</span>
    <span class="n">U_s</span> <span class="o">=</span> <span class="n">qc</span><span class="o">.</span><span class="n">to_gate</span><span class="p">()</span>
    <span class="n">U_s</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;U_s&quot;</span>
    <span class="k">return</span> <span class="n">U_s</span>

<span class="n">grover_circuit</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">diffuser</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)))</span>
<span class="n">grover_circuit</span><span class="o">.</span><span class="n">measure_all</span><span class="p">()</span>
<span class="n">grover_circuit</span><span class="o">.</span><span class="n">decompose</span><span class="p">()</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="s1">&#39;mpl&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/25d5e523d09a59d42ccffc98f974211290a2e43e55e9c30981170c757480fa63.png" src="_images/25d5e523d09a59d42ccffc98f974211290a2e43e55e9c30981170c757480fa63.png" />
</div>
</div>
<p><strong>解答</strong></p>
<div class="toggle docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">diffuser</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="n">qc</span> <span class="o">=</span> <span class="n">QuantumCircuit</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>

    <span class="n">qc</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>

    <span class="c1">##################</span>
    <span class="c1">### EDIT BELOW ###</span>
    <span class="c1">##################</span>

    <span class="n">qc</span><span class="o">.</span><span class="n">rz</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">x</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)))</span>

    <span class="c1"># multi-controlled Zゲート</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">mcx</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)),</span> <span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">qc</span><span class="o">.</span><span class="n">x</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)))</span>

    <span class="c1">##################</span>
    <span class="c1">### EDIT ABOVE ###</span>
    <span class="c1">##################</span>

    <span class="n">qc</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>

    <span class="c1">#print(qc)</span>
    <span class="n">U_s</span> <span class="o">=</span> <span class="n">qc</span><span class="o">.</span><span class="n">to_gate</span><span class="p">()</span>
    <span class="n">U_s</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;U_s&quot;</span>
    <span class="k">return</span> <span class="n">U_s</span>
</pre></div>
</div>
</div>
</section>
<section id="imp-simulator">
<span id="id14"></span><h3><a class="toc-backref" href="#id31">シミュレータでの実験</a><a class="headerlink" href="#imp-simulator" title="Permalink to this heading">#</a></h3>
<p>回路の実装ができたら、シミュレータで実行して結果をプロットしてみます。結果が分かりやすくなるように、測定したビット列を整数にしてからプロットするようにしてみます。</p>
<div class="cell tag_remove-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">simulator</span> <span class="o">=</span> <span class="n">AerSimulator</span><span class="p">()</span>
<span class="n">grover_circuit</span> <span class="o">=</span> <span class="n">transpile</span><span class="p">(</span><span class="n">grover_circuit</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="n">simulator</span><span class="p">)</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">simulator</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">grover_circuit</span><span class="p">,</span> <span class="n">shots</span><span class="o">=</span><span class="mi">1024</span><span class="p">)</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
<span class="n">answer</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">get_counts</span><span class="p">()</span>

<span class="c1"># 横軸を整数でプロットする</span>
<span class="k">def</span> <span class="nf">show_distribution</span><span class="p">(</span><span class="n">answer</span><span class="p">):</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">answer</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">answer</span><span class="o">.</span><span class="n">keys</span><span class="p">())]</span>
    <span class="n">y</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">answer</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
    <span class="n">rect</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">autolabel</span><span class="p">(</span><span class="n">rects</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">rect</span> <span class="ow">in</span> <span class="n">rects</span><span class="p">:</span>
            <span class="n">height</span> <span class="o">=</span> <span class="n">rect</span><span class="o">.</span><span class="n">get_height</span><span class="p">()</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:.3f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">height</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">y</span><span class="p">)),</span>
                        <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">rect</span><span class="o">.</span><span class="n">get_x</span><span class="p">()</span><span class="o">+</span><span class="n">rect</span><span class="o">.</span><span class="n">get_width</span><span class="p">()</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">height</span><span class="p">),</span><span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span>
                        <span class="n">textcoords</span><span class="o">=</span><span class="s2">&quot;offset points&quot;</span><span class="p">,</span><span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">)</span>
    <span class="n">autolabel</span><span class="p">(</span><span class="n">rect</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Probabilities&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">show_distribution</span><span class="p">(</span><span class="n">answer</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>正しく回路が実装できていれば、<span class="math notranslate nohighlight">\(\ket{101101}=\ket{45}\)</span>の状態を高い確率で測定できる様子を見ることができるでしょう。</p>
<p>しかし、上での議論からも分かるように、<span class="math notranslate nohighlight">\(N=2^6\)</span>の探索では、一回のグローバー反復では正しくない答えも無視できない確率で現れてきます。グローバーの反復を複数回繰り返すことで、正しい答えがより高い確率で得られることをこの後見ていきます。</p>
</section>
<section id="imp-qc">
<span id="id15"></span><h3><a class="toc-backref" href="#id32">量子コンピュータでの実験</a><a class="headerlink" href="#imp-qc" title="Permalink to this heading">#</a></h3>
<p>反復を繰り返す前に、まずは一回のグローバー反復を量子コンピュータで実行してみましょう。</p>
<div class="cell tag_raises-exception tag_remove-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 量子コンピュータで実行する場合</span>
<span class="n">instance</span> <span class="o">=</span> <span class="s1">&#39;ibm-q/open/main&#39;</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">provider</span> <span class="o">=</span> <span class="n">IBMProvider</span><span class="p">(</span><span class="n">instance</span><span class="o">=</span><span class="n">instance</span><span class="p">)</span>
<span class="k">except</span> <span class="n">IBMQAccountCredentialsNotFound</span><span class="p">:</span>
    <span class="n">provider</span> <span class="o">=</span> <span class="n">IBMProvider</span><span class="p">(</span><span class="n">token</span><span class="o">=</span><span class="s1">&#39;__paste_your_token_here__&#39;</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span><span class="n">instance</span><span class="p">)</span>

<span class="n">backend_list</span> <span class="o">=</span> <span class="n">provider</span><span class="o">.</span><span class="n">backends</span><span class="p">(</span><span class="n">filters</span><span class="o">=</span><span class="n">operational_backend</span><span class="p">(</span><span class="n">min_qubits</span><span class="o">=</span><span class="mi">6</span><span class="p">))</span>
<span class="n">backend</span> <span class="o">=</span> <span class="n">least_busy</span><span class="p">(</span><span class="n">backend_list</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;least busy backend: &quot;</span><span class="p">,</span> <span class="n">backend</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_raises-exception tag_remove-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 最も空いているバックエンドで回路を実行します。キュー内のジョブの実行をモニターします。</span>

<span class="n">grover_circuit</span> <span class="o">=</span> <span class="n">transpile</span><span class="p">(</span><span class="n">grover_circuit</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="n">backend</span><span class="p">,</span> <span class="n">optimization_level</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">job</span> <span class="o">=</span> <span class="n">backend</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">grover_circuit</span><span class="p">,</span> <span class="n">shots</span><span class="o">=</span><span class="mi">1024</span><span class="p">)</span>
<span class="n">job_monitor</span><span class="p">(</span><span class="n">job</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_raises-exception tag_remove-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 計算結果</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">job</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
<span class="n">answer</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">get_counts</span><span class="p">(</span><span class="n">grover_circuit</span><span class="p">)</span>
<span class="n">show_distribution</span><span class="p">(</span><span class="n">answer</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>シミュレータに比べると結果は非常に悪いですね。。。残念ながら、今の量子コンピュータをそのまま使うとこういう結果になってしまいます。しかし、<a class="reference internal" href="addition_on_ibmq.html#measurement-error-mitigation"><span class="std std-ref">エラー緩和</span></a>等のテクニックを使うことである程度改善することはできます。</p>
</section>
<section id="imp-simulator-amp">
<span id="id16"></span><h3><a class="toc-backref" href="#id33">振幅増幅を確認する</a><a class="headerlink" href="#imp-simulator-amp" title="Permalink to this heading">#</a></h3>
<p>では次に、グローバーのアルゴリズムを繰り返し使うことで、振幅が増幅していく様子をシミュレータを使って見てみましょう。</p>
<p>例として、上で作ったグローバー反復を3回実行する量子回路を作って実行してみます。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 繰り返しの回数</span>
<span class="n">Niter</span> <span class="o">=</span> <span class="mi">3</span>

<span class="n">grover_circuit_iterN</span> <span class="o">=</span> <span class="n">QuantumCircuit</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="n">grover_circuit_iterN</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
<span class="k">for</span> <span class="n">I</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Niter</span><span class="p">):</span>
    <span class="n">grover_circuit_iterN</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">oracle_gate</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)))</span>
    <span class="n">grover_circuit_iterN</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">diffuser</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)))</span>
<span class="n">grover_circuit_iterN</span><span class="o">.</span><span class="n">measure_all</span><span class="p">()</span>
<span class="n">grover_circuit_iterN</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="s1">&#39;mpl&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/b9becef9a6293e0ad319e48ad9d143b0f614e72f7b0bfa4bdab3e8c8f2461076.png" src="_images/b9becef9a6293e0ad319e48ad9d143b0f614e72f7b0bfa4bdab3e8c8f2461076.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">grover_circuit_iterN_tr</span> <span class="o">=</span> <span class="n">transpile</span><span class="p">(</span><span class="n">grover_circuit_iterN</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="n">simulator</span><span class="p">)</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">simulator</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">grover_circuit_iterN_tr</span><span class="p">,</span> <span class="n">shots</span><span class="o">=</span><span class="mi">1024</span><span class="p">)</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
<span class="n">answer</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">get_counts</span><span class="p">()</span>
<span class="n">show_distribution</span><span class="p">(</span><span class="n">answer</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/20342afba7619d375b731fbb61537a03ac31e98d2f52b6e7da46a6d60f5b7a33.png" src="_images/20342afba7619d375b731fbb61537a03ac31e98d2f52b6e7da46a6d60f5b7a33.png" />
</div>
</div>
<p>正しい答え<span class="math notranslate nohighlight">\(\ket{45}\)</span>をより高い確率で測定できていることが分かりますね。</p>
<p>では次に、実装した回路を繰り返し実行して、求める解を観測した回数と反復した回数との相関関係を図にしてみます。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">y</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1"># 例えば10回繰り返す</span>
<span class="k">for</span> <span class="n">Niter</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">11</span><span class="p">):</span>
    <span class="n">grover_circuit_iterN</span> <span class="o">=</span> <span class="n">QuantumCircuit</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="n">grover_circuit_iterN</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">I</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Niter</span><span class="p">):</span>
        <span class="n">grover_circuit_iterN</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">oracle_gate</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)))</span>
        <span class="n">grover_circuit_iterN</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">diffuser</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)))</span>
    <span class="n">grover_circuit_iterN</span><span class="o">.</span><span class="n">measure_all</span><span class="p">()</span>

    <span class="n">grover_circuit_iterN_tr</span> <span class="o">=</span> <span class="n">transpile</span><span class="p">(</span><span class="n">grover_circuit_iterN</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="n">simulator</span><span class="p">)</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">simulator</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">grover_circuit_iterN_tr</span><span class="p">,</span> <span class="n">shots</span><span class="o">=</span><span class="mi">1024</span><span class="p">)</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
    <span class="n">answer</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">get_counts</span><span class="p">()</span>

    <span class="n">x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Niter</span><span class="p">)</span>
    <span class="n">y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">answer</span><span class="p">[</span><span class="nb">format</span><span class="p">(</span><span class="n">Nsol</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="n">n</span><span class="p">)])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;N_iterations&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;# of correct observations (1 solution)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/055793c015df4e8c4d9c27f101c6359f7c1c8af82bf43868259e38268bb52c4a.png" src="_images/055793c015df4e8c4d9c27f101c6359f7c1c8af82bf43868259e38268bb52c4a.png" />
</div>
</div>
<p>この図から、グローバー反復を5~6回程度繰り返すことで、正しい答えを最も高い確率で測定できることが分かりますね。計算で求めた検索に必要な反復回数と一致しているかどうか、確認してみてください。</p>
<p>問題：解が一つの場合で、探索リストのサイズを<span class="math notranslate nohighlight">\(N=2^4\)</span>から<span class="math notranslate nohighlight">\(N=2^{10}\)</span>まで変えた時に、測定で求めた最適な反復回数が<span class="math notranslate nohighlight">\(N\)</span>とどういう関係になっているのか調べてください。</p>
</section>
<section id="imp-simulator-multi">
<span id="id17"></span><h3><a class="toc-backref" href="#id34">複数解の探索の場合</a><a class="headerlink" href="#imp-simulator-multi" title="Permalink to this heading">#</a></h3>
<p>では次に、複数の解を探索する問題に進んでみましょう。2つの整数<span class="math notranslate nohighlight">\(x_1\)</span>と<span class="math notranslate nohighlight">\(x_2\)</span>を見つける問題へ量子回路を拡張して、求める解を観測した回数と反復した回数との相関関係を図にしてみます。</p>
<p>例えば、<span class="math notranslate nohighlight">\(x_1=45\)</span>と<span class="math notranslate nohighlight">\(x_2=26\)</span>の場合は</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">N1</span> <span class="o">=</span> <span class="mi">45</span>
<span class="n">N2</span> <span class="o">=</span> <span class="mi">26</span>

<span class="n">oracle_2sol</span> <span class="o">=</span> <span class="n">QuantumCircuit</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>

<span class="c1"># 45</span>
<span class="n">oracle_2sol</span><span class="o">.</span><span class="n">x</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">oracle_2sol</span><span class="o">.</span><span class="n">x</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">oracle_2sol</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">oracle_2sol</span><span class="o">.</span><span class="n">mcx</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)),</span> <span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">oracle_2sol</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">oracle_2sol</span><span class="o">.</span><span class="n">x</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">oracle_2sol</span><span class="o">.</span><span class="n">x</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>

<span class="c1"># 26</span>
<span class="n">oracle_2sol</span><span class="o">.</span><span class="n">x</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">oracle_2sol</span><span class="o">.</span><span class="n">x</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">oracle_2sol</span><span class="o">.</span><span class="n">x</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="n">oracle_2sol</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">oracle_2sol</span><span class="o">.</span><span class="n">mcx</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)),</span> <span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">oracle_2sol</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">oracle_2sol</span><span class="o">.</span><span class="n">x</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">oracle_2sol</span><span class="o">.</span><span class="n">x</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">oracle_2sol</span><span class="o">.</span><span class="n">x</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

<span class="n">oracle_2sol_gate</span> <span class="o">=</span> <span class="n">oracle_2sol</span><span class="o">.</span><span class="n">to_gate</span><span class="p">()</span>
<span class="n">oracle_2sol_gate</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;U_w(2sol)&quot;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">oracle_2sol</span><span class="p">)</span>

<span class="n">x</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">y</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">Niter</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">11</span><span class="p">):</span>
    <span class="n">grover_circuit_2sol_iterN</span> <span class="o">=</span> <span class="n">QuantumCircuit</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="n">grover_circuit_2sol_iterN</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">I</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Niter</span><span class="p">):</span>
        <span class="n">grover_circuit_2sol_iterN</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">oracle_2sol_gate</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)))</span>
        <span class="n">grover_circuit_2sol_iterN</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">diffuser</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)))</span>
    <span class="n">grover_circuit_2sol_iterN</span><span class="o">.</span><span class="n">measure_all</span><span class="p">()</span>
    <span class="c1">#print(&#39;-----  Niter =&#39;,Niter,&#39; -----------&#39;)</span>
    <span class="c1">#print(grover_circuit_2sol_iterN)</span>

    <span class="n">grover_circuit_2sol_iterN_tr</span> <span class="o">=</span> <span class="n">transpile</span><span class="p">(</span><span class="n">grover_circuit_2sol_iterN</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="n">simulator</span><span class="p">)</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">simulator</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">grover_circuit_2sol_iterN_tr</span><span class="p">,</span> <span class="n">shots</span><span class="o">=</span><span class="mi">1024</span><span class="p">)</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
    <span class="n">answer</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">get_counts</span><span class="p">()</span>
    <span class="c1">#show_distribution(answer)</span>

    <span class="n">x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Niter</span><span class="p">)</span>
    <span class="n">y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">answer</span><span class="p">[</span><span class="nb">format</span><span class="p">(</span><span class="n">N1</span><span class="p">,</span><span class="s1">&#39;06b&#39;</span><span class="p">)]</span><span class="o">+</span><span class="n">answer</span><span class="p">[</span><span class="nb">format</span><span class="p">(</span><span class="n">N2</span><span class="p">,</span><span class="s1">&#39;06b&#39;</span><span class="p">)])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;N_iterations&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;# of correct observations (2 solutions)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>               ┌───┐               ┌───┐     
q_0: ───────■──┤ X ├────────────■──┤ X ├─────
     ┌───┐  │  ├───┤            │  └───┘     
q_1: ┤ X ├──■──┤ X ├────────────■────────────
     └───┘  │  ├───┤            │  ┌───┐     
q_2: ───────■──┤ X ├────────────■──┤ X ├─────
            │  └───┘            │  └───┘     
q_3: ───────■───────────────────■────────────
     ┌───┐  │  ┌───┐            │            
q_4: ┤ X ├──■──┤ X ├────────────■────────────
     ├───┤┌─┴─┐├───┤┌───┐┌───┐┌─┴─┐┌───┐┌───┐
q_5: ┤ H ├┤ X ├┤ H ├┤ X ├┤ H ├┤ X ├┤ H ├┤ X ├
     └───┘└───┘└───┘└───┘└───┘└───┘└───┘└───┘
</pre></div>
</div>
<img alt="_images/2cd0acc9f56c376d08865caaa6ed1d3ec55eaff59d6de8d67673e8f78fade098.png" src="_images/2cd0acc9f56c376d08865caaa6ed1d3ec55eaff59d6de8d67673e8f78fade098.png" />
</div>
</div>
<p>複数解の場合、確率が最大になる反復回数が単一解の場合より減っていますね。予想と合っているでしょうか？</p>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "UTokyo-ICEPP/qc-workbook",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="spectrum_estimation.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">【課題】位相推定によるスペクトル分解</p>
      </div>
    </a>
    <a class="right-next"
       href="grover_number_light.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">【課題】ビット反転ボードの操作を見つける</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">はじめに</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#database">非構造化データの検索</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#grover">グローバーのアルゴリズム</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#grover-phaseoracle">位相オラクルの導入</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#grover-circuit">量子回路の構成</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#grover-superposition">重ね合わせ状態の生成</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#grover-geometry">幾何学的な表現</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#grover-oracle">オラクルの適用</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#diffuser">Diffuserの適用</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#grover-amp">振幅増幅を可視化する</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#grover-multidata">複数データの検索</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#n-2-6">アルゴリズムの実装（<span class="math notranslate nohighlight">\(N=2^6\)</span>の場合）</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#qiskit">Qiskitでの実装</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#imp-simulator">シミュレータでの実験</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#imp-qc">量子コンピュータでの実験</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#imp-simulator-amp">振幅増幅を確認する</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#imp-simulator-multi">複数解の探索の場合</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By 東京大学素粒子物理国際研究センター
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>